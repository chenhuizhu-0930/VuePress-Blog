(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{362:function(e,t,s){"use strict";s.r(t);var a=s(14),r=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("在利用VuePress的Vdoing主题建站的过程中的踩坑和学习记录，发出来仅供参考。")]),e._v(" "),t("h3",{attrs:{id:"_1-全文搜索-上次更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-全文搜索-上次更新"}},[e._v("#")]),e._v(" 1. 全文搜索&上次更新")]),e._v(" "),t("h4",{attrs:{id:"_1-1-启用全文搜索"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-启用全文搜索"}},[e._v("#")]),e._v(" 1.1 启用全文搜索")]),e._v(" "),t("p",[e._v("首先下载"),t("a",{attrs:{href:"https://GitHub.com/leo-buneev/VuePress-plugin-fulltext-search",target:"_blank",rel:"noopener noreferrer"}},[e._v("全文搜索插件"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("npm i VuePress-plugin-fulltext-search -D\n# or\nyarn add VuePress-plugin-fulltext-search -D\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("然后在插件配置中启用该插件（以Vdoing主题为例）")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("plugins: <UserPlugins>['fulltext-search']\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("但是吧这个插件的搜索功能不是很强大， 有的词过短或者没有索引到就搜索不出来，比如这篇文章中的LF就搜索不到。后续其实可以换更强大的搜索插件。")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/chenhuizhu-0930/picx-images-hosting/master/202505291706284.png",alt:""}})]),e._v(" "),t("h4",{attrs:{id:"_1-2-显示上次更新时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-显示上次更新时间"}},[e._v("#")]),e._v(" 1.2 显示上次更新时间")]),e._v(" "),t("h6",{attrs:{id:"方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法"}},[e._v("#")]),e._v(" 方法")]),e._v(" "),t("p",[e._v("在"),t("code",[e._v("deploy.sh")]),e._v("中的"),t("code",[e._v("npm run build:win")]),e._v("之前加入下面内容👇")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('# 提交 Markdown 源文件变更（显示上次更新时间用）\ngit add docs/\ngit commit -m "更新文档内容 $(date \'+%Y-%m-%d %H:%M:%S\')" || echo "无文档变更，无需提交"\necho "✅ Markdown 文件提交完毕"\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("h6",{attrs:{id:"理由"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理由"}},[e._v("#")]),e._v(" 理由")]),e._v(" "),t("p",[e._v("从下图中可以看到，"),t("code",[e._v("npm run deploy")]),e._v("命令实际commit的是构建好的dist文件。而VuePress提供的上次更新时间的插件取的是.md文件commit到本地仓库的时间，如果"),t("code",[e._v(".md")]),e._v(" 文件未曾被"),t("code",[e._v("git commit")]),e._v(", 则插件 "),t("code",[e._v("git log")]),e._v(" 查不到结果，构建后的页面中不会出现“上次更新时间”这行文字。每次更新博客后把.md文件提交到本地仓库就可以了。")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/chenhuizhu-0930/picx-images-hosting/master/202505291644907.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"_2-图床与cdn加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-图床与cdn加速"}},[e._v("#")]),e._v(" 2. 图床与cdn加速")]),e._v(" "),t("p",[e._v("本博客的图床采用"),t("a",{attrs:{href:"https://GitHub.com/Molunerfinn/PicGo",target:"_blank",rel:"noopener noreferrer"}},[e._v("PicGo"),t("OutboundLink")],1),e._v("+GitHub（"),t("a",{attrs:{href:"https://picx.xpoet.cn/#/upload",target:"_blank",rel:"noopener noreferrer"}},[e._v("Picx"),t("OutboundLink")],1),e._v("作为备用）")]),e._v(" "),t("h3",{attrs:{id:"_3-部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-部署"}},[e._v("#")]),e._v(" 3. 部署")]),e._v(" "),t("h4",{attrs:{id:"_3-1-部署到github"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-部署到github"}},[e._v("#")]),e._v(" 3.1 部署到GitHub")]),e._v(" "),t("ol",[t("li",[t("p",[t("code",[e._v("deploy.sh")]),e._v("中的push_addr的GitHub地址用双引号包裹")])]),e._v(" "),t("li",[t("p",[e._v("在bash中运行"),t("code",[e._v("npm run deploy")]),e._v("后报错")])])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("deploy.sh: line 14: $'\\224\\250build:win': command not found\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("豆包了下说\\224\\250是 CRLF 换行符的一部分（"),t("code",[e._v("\\r")]),e._v(" 或 "),t("code",[e._v("\\n")]),e._v("）被错误解析后的结果。于是尝试把"),t("code",[e._v("deploy.sh")]),e._v("的行尾序列从CRLF改为LF。之后再运行就推送成功了。")]),e._v(" "),t("h4",{attrs:{id:"_3-2-部署至vercel-🚀海外访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-部署至vercel-🚀海外访问"}},[e._v("#")]),e._v(" 3.2 部署至Vercel |🚀海外访问")]),e._v(" "),t("h5",{attrs:{id:"_3-2-1-vercel是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-vercel是什么"}},[e._v("#")]),e._v(" 3.2.1 Vercel是什么")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://vercel.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vercel"),t("OutboundLink")],1),e._v(" 和 GitHub Pages 都是部署静态网站的平台，但是GitHub不提供全球CDN加速， Vercel CDN会默认部署到全球边缘节点以加快访问速度。")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("在Vercel中设置了GitHub和Vercel的集成关系（连接到GitHub项目和监听分支）之后，源码推送到 GitHub 可自动触发 Vercel 部署。")])]),e._v(" "),t("li",[t("p",[e._v("构建完成之后，Vercel 会把你的静态文件托管在主源服务器上（即 Vercel Origin），但只有当用户访问页面时，该页面才会被缓存到用户最近的 CDN 边缘节点（懒加载机制）。具体过程如下👇：")])])]),e._v(" "),t("blockquote",[t("p",[t("strong",[e._v("部署：")])]),e._v(" "),t("p",[e._v("📦 部署项目如VuePress → 📁 生成静态文件 → 🗃️ 存放在 Vercel Origin")]),e._v(" "),t("p",[t("strong",[e._v("第一次用户访问某页面：")]),e._v("\n🌍 用户请求页面 → CDN 检查本地缓存 ❌未命中 → 向 Vercel Origin 请求文件 → ✔️缓存该页面到当前 CDN 节点 → 🚀 返回页面")]),e._v(" "),t("p",[t("strong",[e._v("后续其他用户访问该页面：")]),e._v("\n🌍 CDN 命中缓存 → 直接从 CDN 边缘返回内容 ✅ 非常快")])]),e._v(" "),t("h5",{attrs:{id:"_3-2-2-部署踩的坑"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-部署踩的坑"}},[e._v("#")]),e._v(" 3.2.2 部署踩的坑")]),e._v(" "),t("p",[t("strong",[e._v("（1）报错内容")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sh: line 1: VuePress: command not found\nError: Command "VuePress build src" exited with 127\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[t("strong",[e._v("（2）解决")])]),e._v(" "),t("p",[e._v("ChatGPT告诉我这个错误说明：在 Vercel 的构建环境中无法找到 "),t("code",[e._v("VuePress")]),e._v(" 命令，也就是没有安装 VuePress。")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("首先检查VuePress是否在项目"),t("code",[e._v("package.json")]),e._v(" 的Dependencies或devDependencies中。")])]),e._v(" "),t("li",[t("p",[e._v("其次，确保 "),t("code",[e._v("package.json")]),e._v(" 中的 "),t("code",[e._v("scripts")]),e._v(" 包含正确的构建命令。")])])]),e._v(" "),t("p",[e._v("因Vercel无法识别 "),t("code",[e._v("package.json")]),e._v(" 下面的build scripts")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('"build": "export NODE_OPTIONS=--openssl-legacy-provider && node --max_old_space_size=4096 ./node_modules/vuepress/cli.js build docs",\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("于是替换成了👇")]),e._v(" "),t("div",{staticClass:"language-\\ line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('"build": "vuepress build docs"\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("最后，在 Vercel 项目设置中配置：\n"),t("ul",[t("li",[e._v("Build Command: "),t("code",[e._v("npm run build")])]),e._v(" "),t("li",[e._v("Output Directory: "),t("code",[e._v(".VuePress/dist")])])])])]),e._v(" "),t("p",[e._v("Framework Preset选择"),t("code",[e._v("Other")]),e._v("而不是VuePress。Vercel 的 "),t("code",[e._v("VuePress Preset")]),e._v(" 支持的是 VuePress v2（Next），但我的package.json中使用的 VuePress是v1.9.9的，所以这里要改成Other。")]),e._v(" "),t("p",[e._v("按照上述修改后重新部署Vercel就成功了。（哦ChatGPT真好用~~~）")]),e._v(" "),t("h5",{attrs:{id:"_3-2-3-路由到vercel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-路由到vercel"}},[e._v("#")]),e._v(" 3.2.3 路由到Vercel")]),e._v(" "),t("h6",{attrs:{id:"_1-添加域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加域名"}},[e._v("#")]),e._v(" （1）添加域名")]),e._v(" "),t("ul",[t("li",[e._v("在Vercel - Project Setting - Domains中添加域名，完成后会显示两条DNS记录，需要把这两条解析记录添加到域名控制台")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.GitHubusercontent.com/chenhuizhu-0930/picx-images-hosting/master/202505231101874.png",alt:"vercel的DNS界面"}})]),e._v(" "),t("h6",{attrs:{id:"_2-dns配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-dns配置"}},[e._v("#")]),e._v(" （2）DNS配置")]),e._v(" "),t("ul",[t("li",[e._v("打开域名控制台加入记录")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.GitHubusercontent.com/chenhuizhu-0930/picx-images-hosting/master/202505231104006.png",alt:"DNS设置"}})]),e._v(" "),t("h6",{attrs:{id:"_3-验证域名指向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-验证域名指向"}},[e._v("#")]),e._v(" （3）验证域名指向")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nslookup")]),e._v(" www.example.com\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("确认返回的CNAME是cname.vercel-dns.com则成功路由")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.GitHubusercontent.com/chenhuizhu-0930/picx-images-hosting/master/202505231110068.png",alt:"成功路由终端界面"}})]),e._v(" "),t("h6",{attrs:{id:"_4-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-总结"}},[e._v("#")]),e._v(" （4）总结")]),e._v(" "),t("p",[e._v("最后的配置结果是在Vercel上把 "),t("code",[e._v("keijyu.top")]),e._v(" 自动重定向到 "),t("code",[e._v("www.keijyu.top")])]),e._v(" "),t("p",[e._v("把 "),t("code",[e._v("www.keijyu.top")]),e._v(" 作为主域名，配置了 CNAME → "),t("code",[e._v("cname.vercel-dns.com")])]),e._v(" "),t("h4",{attrs:{id:"_3-3-部署至xxx-🚀大陆访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-部署至xxx-🚀大陆访问"}},[e._v("#")]),e._v(" 3.3 部署至XXX |🚀大陆访问")]),e._v(" "),t("p",[t("strong",[e._v("3.3.1 又拍云存储")])]),e._v(" "),t("p",[e._v("参考"),t("a",{attrs:{href:"https://tang.su/2020/09/deploy-GitHub-pages-to-upyun-vercel/",target:"_blank",rel:"noopener noreferrer"}},[e._v("这篇"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("strong",[e._v("3.3.2 Web缓存网")])]),e._v(" "),t("p",[e._v("Web缓存网下的JS CDN服务(国内阿里云CDN加速)\n"),t("a",{attrs:{href:"https://www.webcache.cn/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.webcache.cn"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://code.webcache.cn/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://code.webcache.cn"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://cdnjs.webstatic.cn/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cdnjs.webstatic.cn"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://lib.webstatic.cn/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://lib.webstatic.cn"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("还没研究，之后有空搞一搞。。")]),e._v(" "),t("h4",{attrs:{id:"_3-4-多线部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-多线部署"}},[e._v("#")]),e._v(" 3.4 多线部署")]),e._v(" "),t("p",[e._v("可以采用DNS进行分流，国内线路默认解析至又拍云存储CNAME地址，国外线路解析至Vercel提供的地址，之后研究一下。。")]),e._v(" "),t("h3",{attrs:{id:"_4-评论系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-评论系统"}},[e._v("#")]),e._v(" 4. 评论系统")]),e._v(" "),t("p",[e._v("未来考虑加入，先占个坑。")]),e._v(" "),t("h3",{attrs:{id:"_5-关于写作与推送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-关于写作与推送"}},[e._v("#")]),e._v(" 5. 关于写作与推送")]),e._v(" "),t("p",[e._v("博文使用Typora，在相应文件夹下新增md文件开始写作即可。如果需要放入特定分类和加入标签，---生成yml表头，添加categories和tags属性。其余属性在build的时候Vdoing会自动生成。categories如果不设置我设置的默认值是未分类。")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.GitHubusercontent.com/chenhuizhu-0930/picx-images-hosting/master/202505221051851.png",alt:"博文写作"}})]),e._v(" "),t("p",[e._v("本地build与启动")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("//windows电脑用这个命令，从deploy.sh可知，这个命令会先build再启动服务器\nnpm run dev:win\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("GitHub推送")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("npm run deploy\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_6-参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-参考链接"}},[e._v("#")]),e._v(" 6. 参考链接")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/347990778",target:"_blank",rel:"noopener noreferrer"}},[e._v("vercel是什么神仙网站？"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);